<p-toast></p-toast>
<div class="grid">
  <div class="fadeout animation-duration-2000 animation-iteration-infinite ml-auto mr-2 mb-4 mt-2">
    <p-chip label=" Info for this page" [removable]="true"><i (click)="showInformationDialog()"
        class="fa-solid fa-circle-info fa-xl " style="margin-right: 2px;"></i></p-chip>
  </div>
</div>


<div class="card control-card">
  <div class="date-room-controls">
    <div class="control-group">
      <!-- Başlangıç Tarihi -->
      <div class="input-with-icon">
        <i class="fas fa-calendar-alt"></i>
        <p-calendar id="startDate" [(ngModel)]="startDate" [showButtonBar]="true" dateFormat="dd.mm.yy"
          placeholder="Başlangıç Tarihi" appendTo="body"></p-calendar>
      </div>

      <!-- Bitiş Tarihi -->
      <div class="input-with-icon">
        <i class="fas fa-calendar-alt"></i>
        <p-calendar id="endDate" [(ngModel)]="endDate" [minDate]="startDate" [showButtonBar]="true"
          dateFormat="dd.mm.yy" placeholder="Bitiş Tarihi" appendTo="body"></p-calendar>
      </div>

      <!-- Periyot Ekle -->
      <div>
        <button pButton label="Periyot Ekle" icon="pi pi-plus" (click)="addPeriod()"></button>
      </div>
    </div>
  </div>
</div>

<!-- Accordion İçeriği -->
<div class="content">

  <p-accordion class="w-full" expandIcon="pi pi-plus" collapseIcon="pi pi-minus">
    <p-accordionTab *ngFor="let period of periods; let i = index">
      <ng-template pTemplate="header">
        <div class="flex align-items-center gap-2 w-full header-content">
          <span>Periyot {{ i + 1 }}:</span>
          <span class="font-bold white-space-nowrap">{{ period.startDate | date: 'dd.MM.yyyy' }} - {{ period.endDate |
            date: 'dd.MM.yyyy' }}</span>
          <div class="ml-auto mr-2">
            <button pButton icon="pi pi-trash" class="acordiontab-delete" (click)="removePeriod(i)"></button>
          </div>

          
        </div>
      </ng-template>

      <div class="card">
        <div class="control-group">
          <div class="input-with-icon">
            <p-multiSelect [(ngModel)]="period.selectedRoomTypes" [maxSelectedLabels]="1"
              selectedItemsLabel="{0} oda tipi seçildi" [options]="availableRoomTypes" optionLabel="name"
              placeholder="Oda Tipi Seç" (onChange)="onRoomTypeChange(period)"></p-multiSelect>
            <p-checkbox [(ngModel)]="period.addChildPricing" binary="true" label="Çocuk Fiyatlandırması"
              (onChange)="onChildPricingToggle(period)"></p-checkbox>
          </div>
        </div>


      </div>

      <div class="grid">
        <div *ngFor="let room of period.roomData" class="col-12 md:col-12 lg:col-6">
          <h5>{{ room.roomType }}</h5>
          <div *ngFor="let cell of room.cells" class=" cell-content">
            <!-- Base Fiyat -->
            <div class="input-group ">
              <i class="fas fa-euro-sign "></i>
              <span class="prefix">Base Fiyat</span>
              <p-inputNumber class="" [(ngModel)]="cell.basePrice" mode="currency" [currency]="selectedCurrency"
                [min]="0" (ngModelChange)="onBasePriceChange(cell)"></p-inputNumber>
            </div>

            <!-- Kontejan -->
            <div class="input-group">
              <i class="fas fa-chart-bar"></i>
              <span class="prefix">Kontenjan</span>
              <p-inputNumber class="" [(ngModel)]="cell.allotment" [min]="0"></p-inputNumber>
            </div>

            <!-- Misafir Fiyatları -->
            <ng-container *ngFor="let pax of cell.paxes; let i = index">
              <div class="input-group">
                <i class="fas fa-user "></i>
                <span class="prefix">{{ i + 1 }} kişi için fiyat:</span>
                <p-inputNumber class="" [(ngModel)]="pax.price" mode="currency"
                  [currency]="selectedCurrency"></p-inputNumber>

                <p-dropdown class="" [(ngModel)]="pax.multiplier" [options]="multiplierOptions" optionLabel="label"
                  appendTo="body" optionValue="value" (ngModelChange)="onMultiplierChange(cell, i)"></p-dropdown>
              </div>
            </ng-container>

            <!-- Çocuk Fiyatlandırması -->
            <ng-container *ngIf="period.addChildPricing">
              <ng-container *ngFor="let child of cell.childPricing; let i = index">
                <div class="child-input-group">
                  <i class="fas fa-baby "></i>
                  <span class="prefix">{{ i + 1 }}. Yas Aralığı</span>
                  <p-inputNumber class="child-small-input" [(ngModel)]="child.ageRange.min" [min]="0"
                    placeholder="Min Age"></p-inputNumber>
                  <p-inputNumber class="child-small-input" [(ngModel)]="child.ageRange.max"
                    [min]="child.ageRange.min + 1" placeholder="Max Age"></p-inputNumber>
                  <p-inputNumber class="child-price-input" [(ngModel)]="child.price" [min]="0" mode="currency"
                    [currency]="selectedCurrency" placeholder="Price"></p-inputNumber>
                  x
                  <p-dropdown class="child-small-dropdown" [(ngModel)]="child.multiplier" [options]="multiplierOptions"
                    optionLabel="label" optionValue="value" (ngModelChange)="onChildMultiplierChange(cell, i)"
                    appendTo="body"></p-dropdown>
                </div>
              </ng-container>
            </ng-container>
          </div>
        </div>
      </div>


    </p-accordionTab>
  </p-accordion>
  <button pButton label="Kaydet" icon="pi pi-save" class="save-button" (click)="saveData()"></button>
</div>


<!-- Information Dialog -->
<p-dialog header="Bu Sayfa icin Kullanim Rehberi" [modal]="true" [(visible)]="informationDialogVisible" [style]="{ width: '50rem' }"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }">
  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>

  <p class="mb-5">
    About this page
  </p>
  <p class="mb-5">
    About this page
  </p>
</p-dialog>